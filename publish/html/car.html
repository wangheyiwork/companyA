<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>京东-我的购物车</title><meta name="description" content="京东JD.COM-专业的综合网上购物商城,销售家电、数码通讯、电脑、家居百货、服装服饰、母婴、图书、食品等数万个品牌优质商品.便捷、诚信的服务，为您提供愉悦的网上购物体验!"><meta name="Keywords" content="网上购物,网上商城,手机,笔记本,电脑,MP3,CD,VCD,DV,相机,数码,配件,手表,存储卡,京东"><!-- 引入facicon.ico网页图标 --><link rel="shortcut icon" href="../resource/img/favicon.ico" type="image/x-icon"><!-- 引入css 初始化的css 文件 --><link rel="stylesheet" href="../css/base.css"><!-- 引入公共样式的css 文件 --><link rel="stylesheet" href="../css/common.css"><!-- 引入car css --><link rel="stylesheet" href="../css/car.css"><!-- 先引入jquery  --><!-- <script src="../resource/js/jquery.min.js"></script> --><!-- 在引入我们自己的js文件 --><!-- <script src="../resource/js/car.js"></script> --></head><body><!-- 顶部快捷导航start --><div class="shortcut"><div class="w"><div class="fl"><ul><li><i class="icomoon"></i>广东</li></ul></div><div class="fr"><ul><li><a href="./login.html">你好,请登录</a> <a href="./register.html" class="style-red">免费注册</a></li><li class="spacer"></li><li><a href="./car.html">我的购物车</a></li><li class="spacer"></li><li><a href="./index.html">我的京东</a> <i class="icomoon"></i></li><li class="spacer"></li><li><a href="#">京东会员</a></li><li class="spacer"></li><li><a href="#" class="style-red">企业采购</a><i class="icomoon"></i></li><li class="spacer"></li><li><a href="#">客户服务</a> <i class="icomoon"></i></li><li class="spacer"></li><li><a href="#">网站导航</a> <i class="icomoon"></i></li><li class="spacer"></li><li><a href="#">手机京东</a></li></ul></div></div></div><!-- 顶部快捷导航end  --><!-- header制作 --><div class="header"><div class="w"><!-- logo --><div class="logo"><h1><a href="index.html" title="京东">京东</a></h1></div><h2 style="position:absolute;left:177px;top:70px;font-size:25px">我的购物车</h2><!-- search --><div class="search" style="left:706px"><input style="width:300px" type="text" class="text" placeholder="蓝月亮洗衣液"> <button class="searchBtn"><i class="icomoon"></i></button></div><div class="code"><img src="../resource/img/code.png"></div></div></div><!-- header 结束 --><div class="c-container"><div class="w"><div class="cart-filter-bar"><em>全部商品</em></div><!-- 购物车主要核心区域 --><div class="cart-warp"></div></div></div><!-- footer start --><div class="footer"><div class="w"><!-- mod_service --><div class="mod_service"><ul><li><i class="mod-service-icon mod_service_duo"></i><div class="mod_service_tit"><h3>品类齐全,轻松购物</h3></div></li><li><i class="mod-service-icon mod_service_kuai"></i><div class="mod_service_tit"><h3>多仓直发,急速配送</h3></div></li><li><i class="mod-service-icon mod_service_hao"></i><div class="mod_service_tit"><h3>正品行货,精致服务</h3></div></li><li><i class="mod-service-icon mod_service_sheng"></i><div class="mod_service_tit"><h3>天天低价,畅选无忧</h3></div></li></ul></div><!-- mod_help --><div class="mod_help"><dl class="mod_help_item"><dt>购物指南</dt><dd><a href="#">购物流程</a></dd><dd><a href="#">会员介绍</a></dd><dd><a href="#">生活旅行</a></dd><dd><a href="#">常见问题</a></dd><dd><a href="#">大家电</a></dd><dd><a href="#">联系客服</a></dd></dl><dl class="mod_help_item"><dt>配送方式</dt><dd><a href="#">上门自提</a></dd><dd><a href="#">211限时送</a></dd><dd><a href="#">配送服务查询</a></dd><dd><a href="#">配送费收费标准</a></dd><dd><a href="#">海外配送</a></dd></dl><dl class="mod_help_item"><dt>支付方式</dt><dd><a href="#">货到付款</a></dd><dd><a href="#">在线支付</a></dd><dd><a href="#">分期付款</a></dd><dd><a href="#">公司转账</a></dd></dl><dl class="mod_help_item"><dt>售后服务</dt><dd><a href="#">售后政策</a></dd><dd><a href="#">价格保护</a></dd><dd><a href="#">退款说明</a></dd><dd><a href="#">常见问题</a></dd><dd><a href="#">返修/退换货</a></dd><dd><a href="#">取消订单</a></dd></dl><dl class="mod_help_item"><dt>特色服务</dt><dd><a href="#">夺宝岛</a></dd><dd><a href="#">DIY装机</a></dd><dd><a href="#">延保服务</a></dd><dd><a href="#">京东E卡</a></dd><dd><a href="#">京东通信</a></dd><dd><a href="#">鲸鱼座智能</a></dd></dl><dl class="mod_help_item mod_help_app"><dt>京东自营覆盖区县</dt><dd><sapn>京东已向全国2661个区县提供自营配送服务，支持货到付款、POS机刷卡和售后上门服务。</sapn></dd></dl></div><!-- mod_copyright  --><div class="mod_copyright"><p class="mod_copyright_links">关于我们 | 联系我们 | 联系客服 | 合作招商 | 商家帮助| 营销中心 | 手机京东 | 友情链接 | 销售联盟 | 京东社区 | 风险监测 | 隐私政策 | 京东公益 | English Site | Media & IR</p><p class="mod_copyright_info">京公网安备110000200080号京Cp证070359号|互联网药品信息服务资格证编号(京)经营性20140008新出发京零字第大120007号</p><p class="mod_copyright_info">联网出版许可证编号新出网证(字150号出版物经营许可证|网络文化经营许可证京网文[201412148-348号违法和不良信息举报电话:4006561155</p><p class="mod_copyright_info">Copyright &copyright; C2004-2020京东Dcom版权所有消费者维权热线:4006067733经营证照|(京网械平台备字(2018)第00003</p><p class="mod_copyright_info">京东旗下网站:京东钱包 | 京东智联</p><p class="mod_copyright_link"><img src="../resource/img/footerLink.png" alt=""></p></div></div></div><!-- footer end --><script src="../js/jquery.min.js"></script><script>//获取本地存储的购物车记录
        var shoppingCartRecord = JSON.parse(localStorage.getItem("shppingcart"));
        //获取要渲染的区域
        var table = document.querySelector(".cart-warp");
        // var sumpriceform = document.querySelector(".sumpriceform");


        //获取总价引用
        var allprice = document.querySelector(".price-sum em");

        //渲染封装成函数，每次数据改变都要调用重新渲染页面
        function render() {
            var isallCheck = shoppingCartRecord.every(function(value) {
                return value.ischecked == true;
            })
            console.log(isallCheck);

            var goods_num = 0;
            var goods_allprice = 0;
            shoppingCartRecord.forEach(function(value) {
                if (value.ischecked) {
                    goods_num++;
                    goods_allprice = +(goods_allprice + value.goods_price * value.count).toFixed(2);
                }
            })



            var str = `
            <!-- 头部全选模块 -->
                <div class="cart-thead">
                    <div class="t-checkbox">
                        <input type="checkbox" name="" id="" class="checkall"  ${isallCheck?"checked":""}> 全选
                    </div>
                    <div class="t-goods">商品</div>
                    <div class="t-price">单价</div>
                    <div class="t-num">数量</div>
                    <div class="t-sum">小计</div>
                    <div class="t-action">操作</div>
                </div>

                
                <!-- 商品详细模块 -->
                <div class="cart-item-list">
                    `;
            shoppingCartRecord.forEach(function(value) {
                str += ` 
                    <div class="cart-item">
                        <div class="p-checkbox">
                            <input type="checkbox" class="j-checkbox" data-id="${value.goods_id}" ${value.ischecked ? "checked" : ""} >
                        </div>
                        <div class="p-goods">
                            <div class="p-img">
                                <img src="${value.goods_small_logo}" alt="">
                            </div>
                            <div class="p-msg"><a href="./detail.html?id=${value.goods_id}" >${value.goods_name}</a></div>
                        </div>
                        <div class="p-price">￥${value.goods_price}</div>
                        <div class="p-num">
                            <div class="quantity-form">
                                <a class="decrement" data-id="${value.goods_id}" >-</a>
                                <input type="text" class="itxt" value="${value.count}">
                                <a class="increment" data-id="${value.goods_id}" >+</a>
                            </div>
                        </div>
                        <div class="p-sum">￥${+(value.goods_price*value.count).toFixed(2)}元</div>
                        <div class="p-action"><a class="cancel">删除</a></div>
                    </div>`
            })
            str += `</div>`;



            //<!-- 结算模块 -->
            str += ` <div class="cart-floatbar">
                    <div class="select-all" >
                        <input type="checkbox" name="" id="" class="checkall"  ${isallCheck?"checked":""}>全选
                    </div>
                    <div class="operation">
                        <a class="remove-batch"> 删除选中的商品</a>
                        <a class="clear-all">清理购物车</a>
                    </div>
                    <div class="toolbar-right">
                        <div class="amount-sum">已经选中<em>${goods_num}</em>件商品</div>
                        <div class="price-sum">总价： <em class="allprice">￥${goods_allprice}</em></div>
                        <div class="btn-area">去结算</div>
                    </div>
                </div>
                `;
            table.innerHTML = str;


        }
        //计算总价
        function checkin() {
            var sumPrice = 0;
            shoppingCartRecord.forEach(value => {
                if (value.ischecked) {
                    sumPrice += value.goods_price * value.count;
                }
            });
            // allprice.innerHTML = sumPrice;
            if (!shoppingCartRecord.length) {
                sumpriceform.style.display = "none";
            }

        }


        //将本地存储数据更新
        function update() {
            localStorage.setItem("shppingcart", JSON.stringify(shoppingCartRecord));
        }

        render();
        checkin();
        //利用委托模式，判断点击那个区域
        table.onclick = function(e) {
            //点击全选
            if (e.target.className === "checkall") {
                shoppingCartRecord.forEach(function(value) {
                    value.ischecked = e.target.checked;
                });

                update();
                render();
                checkin();
                console.log(shoppingCartRecord);
                return;
            }
            //点击删除按钮
            if (e.target.className === "cancel") {

                var id = e.target.getAttribute("data-id");

                var goodInfoIndex = shoppingCartRecord.findIndex(function(value) {
                    return value.goods_id === id;

                });
                console.log(goodInfoIndex);
                shoppingCartRecord.splice(goodInfoIndex, 1);
                update();
                render();
                checkin();
                return;

            }
            //点击每个元素前面的复选框
            if (e.target.className === "j-checkbox") {
                var id = e.target.getAttribute("data-id");
                var goodsInfo = shoppingCartRecord.find(value => {
                    return value.goods_id == id;
                });
                goodsInfo.ischecked = e.target.checked;
                update();
                render();
                checkin();
                return;
            }
            //点击减号减少一件商品
            if (e.target.className === "decrement") {
                var id = e.target.getAttribute("data-id");
                var goodsInfo = shoppingCartRecord.find(value => {
                    return value.goods_id == id;
                });
                goodsInfo.count--;
                if (goodsInfo.count <= 1) {
                    goodsInfo.count = 1;
                }
                render();
                checkin();
                update();
                return;
            }
            //点击加号增加一件商品
            if (e.target.className === "increment") {
                var id = e.target.getAttribute("data-id");
                var goodsInfo = shoppingCartRecord.find(value => {
                    return value.goods_id == id;
                });
                goodsInfo.count++;
                render();
                checkin();
                update();
                return;
            }
            //点击清除选中商品
            if (e.target.className === "remove-batch") {

                shoppingCartRecord.forEach(function(value) {
                    if (value.ischecked) {
                        var goodInfoIndex = shoppingCartRecord.findIndex(function(val) {
                            return val.goods_id == value.goods_id;

                        });
                        shoppingCartRecord.splice(goodInfoIndex, 1);
                    }
                })

                update();
                render();
                checkin();
                return;
            }
            //清除购物车清空所有商品
            if (e.target.className === "clear-all") {

                shoppingCartRecord = [];
                table.innerHTML = "<h2><a href='./index.html'>购物车空空如也，快去选购商品吧！</a></h2>"
                update();
                checkin();
                return;
            }

        }</script></body></html>