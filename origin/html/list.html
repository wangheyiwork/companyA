<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>列表页-手机页面！</title>
    <meta name="description" content="京东JD.COM-专业的综合网上购物商城,销售家电、数码通讯、电脑、家居百货、服装服饰、母婴、图书、食品等数万个品牌优质商品.便捷、诚信的服务，为您提供愉悦的网上购物体验!" />
    <meta name="Keywords" content="网上购物,网上商城,手机,笔记本,电脑,MP3,CD,VCD,DV,相机,数码,配件,手表,存储卡,京东." />
    <!-- 引入facicon.ico网页图标 -->
    <link rel="shortcut icon" href="../resource/img/favicon.ico" type="image/x-icon" />
    <!-- 引入css 初始化的css 文件 -->
    <link rel="stylesheet" href="../css/base.css">
    <!-- 引入公共样式的css 文件 -->
    <link rel="stylesheet" href="../css/common.css">
    <!-- 引入 列表页面的css文件 -->
    <link rel="stylesheet" href="../css/list.css">
</head>

<body>
    <!-- 顶部快捷导航start -->
    <div class="shortcut">
        <div class="w">
            <div class="fl">
                <ul>
                    <li> <i class="icomoon"></i>广东</li>

                </ul>
            </div>
            <div class="fr">
                <ul>
                    <li>
                        <div class="unLoginPanel">
                            <a href="./login.html">你好,请登录</a>
                            <a href="./register.html" class="style-red">免费注册</a>
                        </div>
                        <div class="isLoginPanel">
                        </div>

                    </li>
                    <li class="spacer"></li>
                    <li><a href="./car.html">我的购物车</a></li>
                    <li class="spacer"></li>
                    <li>
                        <a href="./index.html">我的京东</a>
                        <i class="icomoon"></i>
                    </li>
                    <li class="spacer"></li>
                    <li><a href="#">京东会员</a></li>
                    <li class="spacer"></li>
                    <li><a href="#" class="style-red">企业采购</a><i class="icomoon"></i></li>
                    <li class="spacer"></li>
                    <li><a href="#">客户服务</a> <i class="icomoon"></i></li>
                    <li class="spacer"></li>
                    <li><a href="#">网站导航</a> <i class="icomoon"></i></li>
                    <li class="spacer"></li>
                    <li><a href="#">手机京东</a> </li>

                </ul>
            </div>
        </div>
    </div>
    <!-- 顶部快捷导航end  -->
    <!-- header制作 -->
    <div class="header ">
        <div class="w">
            <!-- logo -->
            <div class="logo">
                <h1>
                    <a href="index.html" title="京东">京东</a>
                </h1>
            </div>
            <!-- search -->
            <div class="search">
                <input type="text" id="searchText" class="text" placeholder="蓝月亮洗衣液">
                <button class="searchBtn"><i class="icomoon"></i></button>
            </div>
            <!-- hotwrods -->
            <div class="hotwrods">
                <a href="#" class="style-red">辣妈七夕节</a>
                <a href="#">珠宝5折</a>
                <a href="#">iQOO5</a>
                <a href="#">美妆护肤</a>
                <a href="#">0元限量</a>
                <a href="#">电脑数码</a>
                <a href="#">图书柜惠</a>
            </div>
            <div class="shopcar">
                <i class="car"> </i>我的购物车
                <i class="count">80</i>
            </div>
            <div class="code">
                <img src="../resource/img/code.png">
            </div>
            <!-- 底部导航 -->
            <div class="navitems">
                <ul>
                    <li><a href="#" class="style-red  style-bold">秒杀</a></li>
                    <li><a href="#" class="style-red style-bold">优惠券</a></li>
                    <li><a href="#">PLUS会员</a></li>
                    <li><a href="#">品牌闪购</a></li>
                    <li><a href="#">拍卖</a></li>
                    <li><a href="#">京东家电</a></li>
                    <li><a href="#">京东超市</a></li>
                    <li><a href="#">京东生鲜</a></li>
                    <li><a href="#">京东国际</a></li>
                    <li><a href="#">京东金融</a></li>
                </ul>
            </div>
        </div>

    </div>
    <!-- header 结束 -->
    <!-- nav start -->
    <div class="nav">
        <div class="w">
            <div class="sk_list fl">
                <ul>
                    <li><a href="#">品优秒杀</a></li>
                    <li><a href="">即将售罄</a></li>
                    <li><a href="">超值低价</a></li>
                </ul>
            </div>
            <div class="sk_con fl">
                <ul>
                    <li><a href="#">女装</a></li>
                    <li><a href="#" class="style-red">女鞋</a></li>
                    <li><a href="#">男装</a></li>
                    <li><a href="#">男鞋</a></li>
                    <li><a href="#">母婴童装</a></li>
                    <li><a href="#">食品</a></li>
                    <li><a href="#">智能数码</a></li>
                    <li><a href="#">运动户外</a></li>
                    <li><a href="#">更多分类</a></li>
                </ul>

            </div>
        </div>
    </div>
    <!-- nav end  -->

    <!-- 列表页的内容区域 -->
    <div class="sk_container w">
        <div class="sk_hd">
            <img src="../resource/upload/bg_03.png" alt="">
        </div>
        <div id="search_goods" class="sk_bd clearfix">
            <!-- <ul>
                <li class="sk_goods">
                    <a href="detail.html">
                        <img src="../resource/upload/mobile.jpg" alt="">
                        <h5 class="sk_goods_title">Apple苹果iPhone 6s Plus（A1699）32G 金色 移动联通电信4G手机</h5>
                    </a>
                    <p class="sk_goods_price"><em>¥6088</em> <del>￥6988</del></p>
                    <div class="sk_goods_progress">
                        已售<i>87%</i>
                        <div class="bar">
                            <div class="bar_in"></div>
                        </div>
                        剩余<em>29</em>件
                    </div>
                    <a href="#" class="sk_goods_buy">立即抢购</a>

                </li>

            </ul> -->
        </div>
        <!-- page分页制作 -->
        <!-- <div class="page">
            <span class="page_num">
				<a href="#" class="pn_prev">&lt;&lt;上一页 </a>
				<a href="#">1</a>
				<a href="#" class="current">2</a>
				<a href="#">3</a>
				<a href="#">4</a>
				<a href="#">5</a>
				<a href="#" class="dotted">...</a>
				<a href="#" class="pn_next">下一页&gt;&gt;</a>
			</span>
            <span class="page_skip">
				共10页 到第
				<input type="text">
				页
				<button>确定</button>
			</span>
        </div> -->
    </div>

    <!-- 列表页的内容区域 -->



    <!-- footer start -->
    <div class="footer">
        <div class="w">
            <!-- mod_service -->
            <div class="mod_service">
                <ul>
                    <li>
                        <i class="mod-service-icon mod_service_duo"></i>
                        <div class="mod_service_tit">
                            <h3>品类齐全,轻松购物</h3>
                        </div>
                    </li>
                    <li>
                        <i class="mod-service-icon mod_service_kuai"></i>
                        <div class="mod_service_tit">
                            <h3>多仓直发,急速配送</h3>
                        </div>
                    </li>
                    <li>
                        <i class="mod-service-icon mod_service_hao"></i>
                        <div class="mod_service_tit">
                            <h3>正品行货,精致服务</h3>
                        </div>
                    </li>
                    <li>
                        <i class="mod-service-icon mod_service_sheng"></i>
                        <div class="mod_service_tit">
                            <h3>天天低价,畅选无忧</h3>

                        </div>
                    </li>
                </ul>
            </div>
            <!-- mod_help -->
            <div class="mod_help">
                <dl class="mod_help_item">
                    <dt>购物指南</dt>
                    <dd> <a href="#">购物流程 </a></dd>
                    <dd> <a href="#">会员介绍 </a></dd>
                    <dd> <a href="#">生活旅行 </a></dd>
                    <dd> <a href="#">常见问题 </a></dd>
                    <dd> <a href="#">大家电 </a></dd>
                    <dd> <a href="#">联系客服 </a></dd>
                </dl>
                <dl class="mod_help_item">
                    <dt>配送方式</dt>
                    <dd> <a href="#">上门自提 </a></dd>
                    <dd> <a href="#">211限时送 </a></dd>
                    <dd> <a href="#">配送服务查询 </a></dd>
                    <dd> <a href="#">配送费收费标准 </a></dd>
                    <dd> <a href="#">海外配送</a></dd>
                </dl>
                <dl class="mod_help_item">
                    <dt>支付方式</dt>
                    <dd> <a href="#">货到付款 </a></dd>
                    <dd> <a href="#">在线支付 </a></dd>
                    <dd> <a href="#">分期付款 </a></dd>
                    <dd> <a href="#">公司转账 </a></dd>

                </dl>
                <dl class="mod_help_item">
                    <dt>售后服务</dt>
                    <dd> <a href="#">售后政策 </a></dd>
                    <dd> <a href="#">价格保护 </a></dd>
                    <dd> <a href="#">退款说明 </a></dd>
                    <dd> <a href="#">常见问题 </a></dd>
                    <dd> <a href="#">返修/退换货 </a></dd>
                    <dd> <a href="#">取消订单</a></dd>
                </dl>
                <dl class="mod_help_item">
                    <dt>特色服务</dt>
                    <dd> <a href="#">夺宝岛 </a></dd>
                    <dd> <a href="#">DIY装机 </a></dd>
                    <dd> <a href="#">延保服务</a></dd>
                    <dd> <a href="#">京东E卡 </a></dd>
                    <dd> <a href="#">京东通信 </a></dd>
                    <dd> <a href="#">鲸鱼座智能</a></dd>
                </dl>
                <dl class="mod_help_item mod_help_app">
                    <dt>京东自营覆盖区县</dt>
                    <dd>

                        <sapn>京东已向全国2661个区县提供自营配送服务，支持货到付款、POS机刷卡和售后上门服务。</sapn>
                    </dd>
                </dl>
            </div>

            <!-- mod_copyright  -->
            <div class="mod_copyright">
                <p class="mod_copyright_links">
                    关于我们 | 联系我们 | 联系客服 | 合作招商 | 商家帮助| 营销中心 | 手机京东 | 友情链接 | 销售联盟 | 京东社区 | 风险监测 | 隐私政策 | 京东公益 | English Site | Media & IR
                </p>
                <p class="mod_copyright_info">
                    京公网安备110000200080号京Cp证070359号|互联网药品信息服务资格证编号(京)经营性20140008新出发京零字第大120007号
                </p>
                <p class="mod_copyright_info">
                    联网出版许可证编号新出网证(字150号出版物经营许可证|网络文化经营许可证京网文[201412148-348号违法和不良信息举报电话:4006561155
                </p>
                <p class="mod_copyright_info">
                    Copyright &copyright; C2004-2020京东Dcom版权所有消费者维权热线:4006067733经营证照|(京网械平台备字(2018)第00003
                </p>
                <p class="mod_copyright_info">
                    京东旗下网站:京东钱包 | 京东智联
                </p>
                <p class="mod_copyright_link">
                    <img src="../resource/img/footerLink.png" alt="">
                </p>

            </div>
        </div>
    </div>
    <!-- footer end -->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/Pagination.js"></script>
    <script>
        ;
        $(function() {
            //-----------------------------------------
            //搜索内容
            var $searchMsg = $("#searchText");
            var $searchBtn = $(".searchBtn");
            var $search_goods = $("#search_goods");


            //其他页面传过来的搜索内容进行处理
            var getSearchName = function(key) {

                var querystring = decodeURIComponent(location.search).slice(1);

                var arr = querystring.split("&");

                for (var i = 0; i < arr.length; i++) {
                    var subArr = arr[i].split("=");
                    if (subArr[0] == key) {
                        return subArr[1];
                    }
                }
            }

            //该数组存储数据库中所有商品
            var allgoodsarr = [];
            //发送ajax请求向服务器拿到所有商品信息并赋值给该数组
            $.post("/jingdongphp/sumgoods.php", {}, function(data) {
                if (!data.error) {
                    allgoodsarr = data.data;
                } else { //弹出错误信息
                    console.log("没有拿到数据");
                }
            }, "json");

            //点击搜索按钮时，向服务器发送请求查询有没相关该商品信息并且渲染
            $searchBtn.click(function() {
                $search_goods.empty();
                $.get("/jingdongphp/allgoodsinfo.php", {
                    searchname: $searchMsg.val()
                }, function(data) {
                    if (!data.error) {
                        // console.log(allgoodsarr);
                        var p = new Pagination($search_goods[0], data.data, 0, 12);
                        //arr为当前页的数据
                        p.display(function(arr) {
                            var str = "<ul>";
                            arr.forEach(function(value) {
                                str += `   
                            
                            <li class="sk_goods">
                    <a href="./detail.html?id=${value.goods_id}">
                        <img src=${value.goods_small_logo} alt="">
                        <h5 class="sk_goods_title">${value.goods_name}</h5>
                    </a>
                    <p class="sk_goods_price"><em>¥${value.goods_price}</em> <del>￥${value.goods_price}</del></p>
                    <div class="sk_goods_progress">
                        已售<i>87%</i>
                        <div class="bar">
                            <div class="bar_in"></div>
                        </div>
                        剩余<em>${value.goods_number}</em>件
                    </div>
                    <a class="sk_goods_buy" data-id=${value.goods_id}>加入购物车</a>

                </li>
                   `;
                            });
                            str += `</ul>`;
                            return str;
                        });
                        //-------------加入购物车-----------------
                        //点击加入购物车按钮，向本地存储存入该商品信息
                        $(".sk_goods").click(function(e) {
                            if (e.target.className == "sk_goods_buy") {
                                var goodID = e.target.getAttribute("data-id");
                                var goodsInfo = allgoodsarr.find(function(value) {
                                    return value.goods_id == goodID;
                                })
                                console.log(goodID);

                                //刚开始拿到的是以前的记录开始累加，或者是新数组
                                var shopCartRecordstring = localStorage.getItem("shppingcart") || "[]";


                                //把新的字符串转为数组
                                var shopCartRecordarr = JSON.parse(shopCartRecordstring);

                                var existRecord = shopCartRecordarr.find(function(value) {
                                    return value.goods_id == goodID;
                                })
                                if (existRecord) {
                                    existRecord.count++;
                                } else {
                                    goodsInfo.count = 1;
                                    shopCartRecordarr.push(goodsInfo);
                                }
                                console.log(shopCartRecordarr.length);
                                localStorage.setItem("shppingcart", JSON.stringify(shopCartRecordarr));
                                location.href = "./car.html";
                            }

                        })

                    } else {
                        console.log("没有拿到数据");
                    }
                }, "json")


            })

            if (getSearchName("searchMsg")) {
                $searchMsg.val(getSearchName("searchMsg"));
                $searchBtn.click();
            }







        })
    </script>
</body>

</html>